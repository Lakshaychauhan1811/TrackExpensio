<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrackExpensio – Complete Financial Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/expense_tracker.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-wallet"></i>
                <span class="brand-title">Track<span>Expensio</span></span>
            </div>
            <div class="nav-actions">
                <div class="user-profile-container" id="userProfileContainer" style="display: none;">
                    <div class="user-profile-trigger" id="userProfileTrigger">
                        <img id="userAvatar" src="" alt="User" class="user-avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="user-avatar-fallback" style="display: none;">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="user-name" id="userName"></span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="user-profile-dropdown" id="userProfileDropdown">
                        <div class="user-profile-header">
                            <img id="dropdownAvatar" src="" alt="User" class="dropdown-avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="dropdown-avatar-fallback" style="display: none;">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-profile-info">
                                <div class="user-profile-name" id="dropdownUserName"></div>
                                <div class="user-profile-email" id="dropdownUserEmail"></div>
                            </div>
                        </div>
                        <div class="user-profile-divider"></div>
                        <button class="user-profile-item" id="signOutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Sign Out</span>
                        </button>
                    </div>
                </div>
                <button class="nav-btn accent" id="gmailConnectBtn" title="Save your data permanently with Google">
                    <i class="fas fa-cloud"></i> <span class="nav-btn-text">Sync with Google</span>
                </button>
                <button class="nav-btn" id="helpBtn">
                    <i class="fas fa-question-circle"></i> <span class="nav-btn-text">Help</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                <button class="sidebar-btn active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="sidebar-btn" data-section="chat">
                    <i class="fas fa-comments"></i> AI Chat
                </button>
                <button class="sidebar-btn" data-section="expenses">
                    <i class="fas fa-receipt"></i> Expenses
                </button>
                <button class="sidebar-btn" data-section="income">
                    <i class="fas fa-dollar-sign"></i> Income
                </button>
            </div>

            <div class="sidebar-section">
                <h3><i class="fas fa-cog"></i> Features</h3>
                <button class="sidebar-btn" data-section="budget">
                    <i class="fas fa-piggy-bank"></i> Budget
                </button>
                <button class="sidebar-btn" data-section="recurring">
                    <i class="fas fa-sync-alt"></i> Recurring
                </button>
                <button class="sidebar-btn" data-section="savings">
                    <i class="fas fa-bullseye"></i> Savings Goals
                </button>
                <button class="sidebar-btn" data-section="debt">
                    <i class="fas fa-credit-card"></i> Debt
                </button>
                <button class="sidebar-btn" data-section="investments">
                    <i class="fas fa-chart-bar"></i> Investments
                </button>
                <button class="sidebar-btn" data-section="reports">
                    <i class="fas fa-file-alt"></i> Reports
                </button>
                <button class="sidebar-btn" data-section="taxes">
                    <i class="fas fa-calculator"></i> Tax Calculator
                </button>
                <button class="sidebar-btn" data-section="credit">
                    <i class="fas fa-star"></i> Credit Score
                </button>
                <button class="sidebar-btn" data-section="bills">
                    <i class="fas fa-bell"></i> Bill Reminders
                </button>
                <button class="sidebar-btn" data-section="currency">
                    <i class="fas fa-globe"></i> Multi-Currency
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content-area">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <div>
                        <span class="brand-chip">TrackExpensio</span>
                        <h1><i class="fas fa-chart-line"></i> Financial Command Center</h1>
                        <p>Comprehensive financial intelligence at your fingertips</p>
                    </div>
                </div>

                <div class="model-hero">
                    <div class="hero-copy">
                        <p class="hero-eyebrow">Feature-in-Motion · Groq + LangGraph</p>
                        <h2>Single assistant, every money move.</h2>
                        <ul>
                            <li><i class="fas fa-magic"></i> Conversational budgets, reminders & insights</li>
                            <li><i class="fas fa-receipt"></i> Drag-drop bills → auto expenses via RAG</li>
                            <li><i class="fas fa-chart-area"></i> Live Yahoo Finance lookups & portfolio tips</li>
                        </ul>
                    </div>
                    <div class="hero-visual">
                        <div class="hero-orb"></div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card income">
                        <div class="stat-icon"><i class="fas fa-arrow-up"></i></div>
                        <div class="stat-info">
                            <h3>Total Income</h3>
                            <p class="stat-value" id="totalIncome">$0.00</p>
                            <span class="stat-period">This Month</span>
                        </div>
                    </div>
                    <div class="stat-card expense">
                        <div class="stat-icon"><i class="fas fa-arrow-down"></i></div>
                        <div class="stat-info">
                            <h3>Total Expenses</h3>
                            <p class="stat-value" id="totalExpense">$0.00</p>
                            <span class="stat-period">This Month</span>
                        </div>
                    </div>
                    <div class="stat-card savings">
                        <div class="stat-icon"><i class="fas fa-piggy-bank"></i></div>
                        <div class="stat-info">
                            <h3>Savings</h3>
                            <p class="stat-value" id="totalSavings">$0.00</p>
                            <span class="stat-period">Goals Progress</span>
                        </div>
                    </div>
                    <div class="stat-card networth">
                        <div class="stat-icon"><i class="fas fa-wallet"></i></div>
                        <div class="stat-info">
                            <h3>Net Worth</h3>
                            <p class="stat-value" id="netWorth">$0.00</p>
                            <span class="stat-period">Total Assets</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h2><i class="fas fa-bolt"></i> Instant Actions</h2>
                    <div class="action-grid">
                        <button class="action-card" onclick="showSection('expenses')">
                            <i class="fas fa-plus-circle"></i>
                            <span>Add Expense</span>
                        </button>
                        <button class="action-card" onclick="showSection('income')">
                            <i class="fas fa-dollar-sign"></i>
                            <span>Add Income</span>
                        </button>
                        <button class="action-card" onclick="showSection('budget')">
                            <i class="fas fa-piggy-bank"></i>
                            <span>Set Budget</span>
                        </button>
                        <button class="action-card" onclick="showSection('chat')">
                            <i class="fas fa-robot"></i>
                            <span>Ask AI</span>
                        </button>
                    </div>
                </div>

                <div class="market-widget">
                    <div class="market-header">
                        <div>
                            <h3><i class="fas fa-line-chart"></i> Live Market Pulse</h3>
                            <p>Powered by Yahoo Finance via LangGraph MCP</p>
                        </div>
                        <form id="marketForm" onsubmit="lookupTicker(event)">
                            <input type="text" id="marketSymbol" placeholder="AAPL or INFY.NS" autocomplete="off">
                            <button type="submit" class="btn-primary">Fetch</button>
                        </form>
                    </div>
                    <div id="marketResult" class="market-result">
                        Enter a ticker to see price, range, and market cap.
                    </div>
                </div>

                <!-- Privacy & Cloud Sync -->
                <div class="secure-sync-card">
                    <div>
                        <h3><i class="fas fa-lock"></i> Private MongoDB Vault</h3>
                        <p>Each user gets an isolated MongoDB collection with end-to-end encryption at rest, so other users can never touch your numbers.</p>
                    </div>
                    <button class="btn-primary ghost" onclick="initiateGmailConnect()">
                        <i class="fas fa-cloud"></i> Sync with Gmail & Drive
                    </button>
                </div>

                <!-- Audio & Document Intelligence -->
                <div class="intelligence-row single">
                    <div class="intelligence-card rag-card">
                        <div class="card-header">
                            <i class="fas fa-file-invoice-dollar"></i>
                            <div>
                                <h3>Intelligent Document Processor</h3>
                                <p>Upload invoices or PDFs – advanced RAG pipeline extracts amounts, merchants, and dates</p>
                            </div>
                        </div>
                        <label class="file-drop tall">
                            <input type="file" id="docUpload" accept=".pdf,.png,.jpg,.jpeg">
                            <i class="fas fa-cloud-arrow-up"></i>
                            <span>Drop your bill PDF / image</span>
                        </label>
                        <ul class="rag-highlights">
                            <li><i class="fas fa-circle-check"></i> LangGraph + FAISS memory</li>
                            <li><i class="fas fa-circle-check"></i> Groq LLM for structured extraction</li>
                            <li><i class="fas fa-circle-check"></i> Saved privately in MongoDB</li>
                        </ul>
                    </div>
                </div>

                <!-- Feature Marquee -->
                <div class="features-showcase">
                    <h2><i class="fas fa-star"></i> 14 Feature Pods</h2>
                    <div class="feature-grid" id="featureGrid"></div>
                </div>
            </section>

            <!-- AI Chat Section -->
            <section id="chat" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-robot"></i> Financial Intelligence Assistant</h1>
                    <p>Engage with your financial data through natural conversation</p>
                </div>

                <div class="chat-container">
                    <div class="chat-examples">
                        <h3>Try saying:</h3>
                        <div class="example-chips">
                            <button class="example-chip" onclick="sendExample('Add 150 rupees for snacks today from CCD')">
                                "Add 150 rupees for snacks today from CCD"
                            </button>
                            <button class="example-chip" onclick="sendExample('Show my last week summary')">
                                "Show my last week summary"
                            </button>
                            <button class="example-chip" onclick="sendExample('Give me insights for this month')">
                                "Give me insights for this month"
                            </button>
                            <button class="example-chip" onclick="sendExample('Check my budget status')">
                                "Check my budget status"
                            </button>
                            <button class="example-chip" onclick="sendExample('What are my upcoming bills?')">
                                "What are my upcoming bills?"
                            </button>
                        </div>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div class="message bot-message">
                            <div class="message-avatar"><i class="fas fa-robot"></i></div>
                            <div class="message-content">
                                <p>Greetings! I'm your Financial Intelligence Assistant. I can assist you with:</p>
                                <ul>
                                    <li>Add expenses and income</li>
                                    <li>Check budgets and savings goals</li>
                                    <li>Generate financial reports</li>
                                    <li>Track debts and investments</li>
                                    <li>And much more!</li>
                                </ul>
                                <p>Just ask me anything in natural language!</p>
                            </div>
                        </div>
                    </div>

                    <div class="chat-input-container">
                        <button class="chat-upload-btn" id="chatDocButton" title="Upload receipt">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <input type="text" id="chatInput" class="chat-input" placeholder="Query your financial data in natural language...">
                        <button class="chat-send-btn" onclick="sendChatMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                        <input type="file" id="chatDocInput" accept=".pdf,.png,.jpg,.jpeg" hidden>
                    </div>
                </div>
            </section>

            <!-- Expenses Section -->
            <section id="expenses" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-receipt"></i> Expenses</h1>
                    <button class="btn-primary" onclick="showAddExpenseModal()">
                        <i class="fas fa-plus"></i> Add Expense
                    </button>
                </div>

                <div class="expense-filters">
                    <input type="date" id="expenseStartDate" class="filter-input">
                    <input type="date" id="expenseEndDate" class="filter-input">
                    <button class="btn-secondary" onclick="loadExpenses()">
                        <i class="fas fa-filter"></i> Filter
                    </button>
                </div>

                <div class="expense-list" id="expenseList">
                    <!-- Expenses will be loaded here -->
                </div>
            </section>

            <!-- Income Section -->
            <section id="income" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-dollar-sign"></i> Income</h1>
                    <button class="btn-primary" onclick="showAddIncomeModal()">
                        <i class="fas fa-plus"></i> Add Income
                    </button>
                </div>

                <div class="income-list" id="incomeList">
                    <!-- Income will be loaded here -->
                </div>
            </section>

            <!-- Budget Section -->
            <section id="budget" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-piggy-bank"></i> Budget Management</h1>
                    <button class="btn-primary" onclick="showSetBudgetModal()">
                        <i class="fas fa-plus"></i> Set Budget
                    </button>
                </div>

                <div class="budget-status" id="budgetStatus">
                    <!-- Budget status will be loaded here -->
                </div>
            </section>

            <!-- Bills Section -->
            <section id="bills" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-bell"></i> Bill Reminders</h1>
                </div>
                <div class="bill-list" id="billList">
                    <p class="empty-state">No bill reminders yet. Ask the assistant to "add a reminder for rent on 5th".</p>
                </div>
            </section>

            <!-- Investments Section -->
            <section id="investments" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-chart-bar"></i> Investments & Market Data</h1>
                    <p>Get real-time stock and mutual fund data powered by Yahoo Finance</p>
                </div>

                <div class="market-widget">
                    <div class="market-header">
                        <div>
                            <h3><i class="fas fa-line-chart"></i> Live Market Pulse</h3>
                            <p>Powered by Yahoo Finance via LangGraph MCP</p>
                        </div>
                        <form id="marketForm" onsubmit="lookupTicker(event)">
                            <input type="text" id="marketSymbol" placeholder="AAPL, TSLA, INFY.NS, or any ticker" autocomplete="off">
                            <button type="submit" class="btn-primary">Fetch</button>
                        </form>
                    </div>
                    <div id="marketResult" class="market-result">
                        Enter a ticker symbol to see price, market cap, returns, and more.
                    </div>
                </div>

                <div class="investment-tips">
                    <h3><i class="fas fa-lightbulb"></i> Tips</h3>
                    <ul>
                        <li>Use US tickers like <strong>AAPL</strong>, <strong>TSLA</strong>, <strong>GOOGL</strong> for US stocks</li>
                        <li>Use <strong>.NS</strong> suffix for Indian stocks (e.g., <strong>INFY.NS</strong>, <strong>RELIANCE.NS</strong>)</li>
                        <li>Ask the AI assistant: "Show me AAPL stock data" or "What's the price of TSLA?"</li>
                        <li>View returns for 1 day, 1 week, 1 month, 3 months, 6 months, and 1 year</li>
                    </ul>
                </div>
            </section>

            <!-- Other sections will follow similar pattern -->
            <!-- Recurring, Savings, Debt, Reports, Taxes, Credit, Currency sections -->
            
        </main>
    </div>

    <div id="authOverlay" class="auth-overlay">
        <div class="auth-card">
            <h2><i class="fas fa-cloud"></i> Connect with Google</h2>
            <p>For privacy and syncing, sign in with Google before using TrackExpensio.</p>
            <div class="overlay-actions">
                <button class="btn-primary" onclick="initiateGmailConnect()">
                    <i class="fas fa-link"></i> Sync with Google
                </button>
                <button class="btn-secondary" onclick="refreshSessionStatus()">
                    <i class="fas fa-rotate"></i> I’ve connected
                </button>
            </div>
            <small>Your data stays in your private MongoDB collection.</small>
        </div>
    </div>

    <!-- Modals -->
    <!-- API Key modal removed - using guest sessions now -->

    <!-- Add Expense Modal -->
    <div id="addExpenseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addExpenseModal')">&times;</span>
            <h2><i class="fas fa-plus-circle"></i> Add Expense</h2>
            <form id="addExpenseForm" onsubmit="addExpense(event)">
                <input type="date" id="expenseDate" class="modal-input" required>
                <input type="number" id="expenseAmount" placeholder="Amount" class="modal-input" required>
                <input type="text" id="expenseCategory" placeholder="Category" class="modal-input" required>
                <input type="text" id="expenseMerchant" placeholder="Merchant" class="modal-input">
                <textarea id="expenseNote" placeholder="Note (optional)" class="modal-input"></textarea>
                <button type="submit" class="btn-primary">Add Expense</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/expense_tracker.js"></script>
</body>
</html>

